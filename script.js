const gamesData = {
    "mobile-legend": {
        title: "Mobile Legends: Bang Bang",
        subtitle: "Moonton",
        logo: "https://placehold.co/40x40/505050/ffffff?text=ML",
        sections: [
            {
                title: "Diamond",
                nominals: [
                    { amount: "95 Diamond", price: "Rp 27.500" },
                    { amount: "170 Diamond", price: "Rp 46.000" },
                    { amount: "257 Diamond", price: "Rp 69.500" },
                    { amount: "305 Diamond", price: "Rp 80.000" },
                    { amount: "500 Diamond", price: "Rp 91.000" },
                    { amount: "568 Diamond", price: "Rp 143.500" },
                    { amount: "875 Diamond", price: "Rp 230.000" },
                    { amount: "1048 Diamond", price: "Rp 270.000" },
                    { amount: "1159 Diamond", price: "Rp 299.500" },
                ]
            },
            {
                title: "Wdp",
                nominals: [
                    { amount: "Wdp", price: "Rp 28.000" },
                ]
            }
        ]
    },
    "free-fire": {
        title: "Free Fire",
        subtitle: "Garena",
        logo: "https://placehold.co/40x40/505050/ffffff?text=FF",
        sections: [
            {
                title: "Diamond",
                nominals: [
                    { amount: "5 Diamond", price: "Rp 1.000" },
                    { amount: "12 Diamond", price: "Rp 2.000" },
                    { amount: "50 Diamond", price: "Rp 8.000" },
                    { amount: "70 Diamond", price: "Rp 10.000" },
                    { amount: "120 Diamond", price: "Rp 19.000" },
                    { amount: "355 Diamond", price: "Rp 48.000" },
                    { amount: "720 Diamond", price: "Rp 98.000" },
                    { amount: "1450 Diamond", price: "Rp 201.000" },
                    { amount: "2180 Diamond", price: "Rp 302.000" },
                ]
            },
            {
                title: "Membership",
                nominals: [
                    { amount: "Membership mingguan lite", price: "Rp 15.000" },
                    { amount: "Membership mingguan biasa", price: "Rp 30.000" },
                    { amount: "Membership bulanan", price: "Rp 86.000" },
                ]
            }
        ]
    },
    "roblox": {
        title: "Roblox",
        subtitle: "Roblox Corporation",
        logo: "https://placehold.co/40x40/505050/ffffff?text=R",
        sections: [
            {
                title: "Robux Biasa",
                nominals: [
                    { amount: "400 Robux", price: "Rp 85.000" },
                    { amount: "800 Robux", price: "Rp 159.000" },
                    { amount: "1600 Robux", price: "Rp 310.000" },
                    { amount: "400 Robux", price: "Rp 762.000" },
                ]
            },
            {
                title: "Robux Gamepas",
                nominals: [
                    { amount: "100 Robux", price: "Rp 14.000" },
                    { amount: "200 Robux", price: "Rp 27.000" },
                    { amount: "300 Robux", price: "Rp 40.000" },
                    { amount: "400 Robux", price: "Rp 54.000" },
                    { amount: "500 Robux", price: "Rp 67.000" },
                    { amount: "600 Robux", price: "Rp 80.000" },
                    { amount: "700 Robux", price: "Rp 93.000" },
                    { amount: "800 Robux", price: "Rp 106.000" },
                    { amount: "900 Robux", price: "Rp 120.000" },
                    { amount: "1000 Robux", price: "Rp 133.000" },
                ]
            }
        ]
    },
    "genshin-impact": {
        title: "Genshin Impact",
        subtitle: "miHoYo",
        logo: "https://placehold.co/40x40/505050/ffffff?text=GI",
        sections: [
            {
                title: "Crystal",
                nominals: [
                    { amount: "60 Crystal", price: "Rp 13.000" },
                    { amount: "330 Crystal", price: "Rp 59.000" },
                    { amount: "1090 (980 + 110)", price: "Rp 177.000" },
                    { amount: "2240 (1980 + 260)", price: "Rp 381.000" },
                ]
            },
            {
                title: "Special Item",
                nominals: [
                    { amount: "Blessing of the Welkin Moon", price: "Rp 58.000" },
                    { amount: "2x Blessing of the Welkin Moon", price: "Rp 116.000" },
                ]
            }
        ]
    },
    "codm": {
        title: "Call of Duty Mobile",
        subtitle: "Activision",
        logo: "https://placehold.co/40x40/505050/ffffff?text=CODM",
        sections: [
            {
                title: "Garena Shells",
                nominals: [
                    { amount: "33 Garena Shells", price: "Rp 10.000" },
                    { amount: "66 Garena Shells", price: "Rp 20.000" },
                    { amount: "165 Garena Shells", price: "Rp 50.000" },
                    { amount: "330 Garena Shells", price: "Rp 100.000" },
                ]
            }
        ]
    },
    "hok": {
        title: "Honor of Kings",
        subtitle: "Tencent",
        logo: "https://placehold.co/40x40/505050/ffffff?text=HOK",
        sections: [
            {
                title: "Tokens",
                nominals: [
                    { amount: "16 Tokens", price: "Rp 3.000" },
                    { amount: "80 + 8 Tokens", price: "Rp 15.000" },
                    { amount: "240 + 17 Tokens", price: "Rp 44.000" },
                    { amount: "400 + 32 Tokens", price: "Rp 73.000" },
                    { amount: "560 + 45 Tokens", price: "Rp 102.000" },
                    { amount: "800 + 95 Tokens", price: "Rp 146.000" },
                    { amount: "1200 + 153 Tokens", price: "Rp 220.000" },
                ]
            }
        ]
    },
    "fc-mobile": {
        title: "FC Mobile",
        subtitle: "Electronic Arts",
        logo: "https://placehold.co/40x40/505050/ffffff?text=FC",
        sections: [
            {
                title: "FC Point",
                nominals: [
                    { amount: "40 FC Point", price: "Rp 6.500" },
                    { amount: "100 FC Point", price: "Rp 16.000" },
                    { amount: "520 FC Point", price: "Rp 78.000" },
                    { amount: "1070 FC Point", price: "Rp 156.500" },
                    { amount: "2200 FC Point", price: "Rp 232.500" },
                    { amount: "5750 FC Point", price: "Rp 785.000" },
                    { amount: "12000 FC Point", price: "Rp 1.571.000" },
                ]
            },
            {
                title: "Silver",
                nominals: [
                    { amount: "39 Silver", price: "Rp 6.500" },
                    { amount: "99 Silver", price: "Rp 16.000" },
                    { amount: "499 Silver", price: "Rp 78.000" },
                    { amount: "999 Silver", price: "Rp 156.500" },
                    { amount: "1999 Silver", price: "Rp 232.500" },
                    { amount: "4999 Silver", price: "Rp 785.000" },
                    { amount: "9999 Silver", price: "Rp 1.571.000" },
                ]
            }
        ]
    },
    "guardian-tales": {
        title: "Guardian Tales",
        subtitle: "Kakao Games",
        logo: "https://placehold.co/40x40/505050/ffffff?text=GT",
        sections: [
            {
                title: "Bundle",
                nominals: [
                    { amount: "Bundle starter s3", price: "Rp 277.000" },
                    { amount: "Bundle special costume", price: "Rp 510.000" },
                    { amount: "Bundle skip iklan", price: "Rp 70.000" },
                    { amount: "Paket special bulanan", price: "Rp 50.000" },
                ]
            }
        ]
    },
    "pubg": {
        title: "PUBG Mobile",
        subtitle: "Tencent Games",
        logo: "https://placehold.co/40x40/505050/ffffff?text=PUBG",
        sections: [
            {
                title: "UC",
                nominals: [
                    { amount: "60 UC", price: "Rp 14.500" },
                    { amount: "120 UC", price: "Rp 29.000" },
                    { amount: "180 UC", price: "Rp 43.000" },
                    { amount: "240 UC", price: "Rp 58.000" },
                    { amount: "325 UC", price: "Rp 73.991" },
                    { amount: "385 UC", price: "Rp 87.500" },
                    { amount: "445 UC", price: "Rp 101.910" },
                    { amount: "505 UC", price: "Rp 116.500" },
                ]
            }
        ]
    },
    "super-sus": {
        title: "Super Sus",
        subtitle: "PI Games",
        logo: "https://placehold.co/40x40/505050/ffffff?text=SS",
        sections: [
            {
                title: "Gem",
                nominals: [
                    { amount: "250 gem", price: "Rp 9.000" },
                    { amount: "800 gem", price: "Rp 14.000" },
                    { amount: "900 gem", price: "Rp 15.000" },
                    { amount: "1800 gem", price: "Rp 22.000" },
                    { amount: "5750 gem", price: "Rp 52.000" },
                    { amount: "15000 gem", price: "Rp 131.000" },
                    { amount: "32000 gem", price: "Rp 171.000" },
                ]
            },
            {
                title: "Token",
                nominals: [
                    { amount: "120 token", price: "Rp 34.000" },
                    { amount: "1300 token", price: "Rp 271.000" },
                ]
            }
        ]
    },
    "magic-chess": {
        title: "Magic Chess Go Go",
        subtitle: "Moonton",
        logo: "https://placehold.co/40x40/505050/ffffff?text=MC",
        sections: [
            {
                title: "Diamond",
                nominals: [
                    { amount: "12 Diamond", price: "Rp 3.000" },
                    { amount: "28 Diamond", price: "Rp 6.000" },
                    { amount: "44 Diamond", price: "Rp 9.500" },
                    { amount: "59 Diamond", price: "Rp 13.000" },
                    { amount: "85 Diamond", price: "Rp 15.000" },
                    { amount: "170 Diamond", price: "Rp 36.000" },
                    { amount: "240 Diamond", price: "Rp 49.000" },
                    { amount: "296 Diamond", price: "Rp 61.000" },
                    { amount: "408 Diamond", price: "Rp 82.000" },
                    { amount: "568 Diamond", price: "Rp 111.000" },
                    { amount: "875 Diamond", price: "Rp 106.000" },
                    { amount: "2010 Diamond", price: "Rp 78.000" },
                    { amount: "4830 Diamond", price: "Rp 57.000" },
                ]
            },
            {
                title: "WDP",
                nominals: [
                    { amount: "WDP", price: "Rp 27.000" },
                ]
            }
        ]
    },
    "valorant": {
        title: "Valorant",
        subtitle: "Riot Games",
        logo: "https://placehold.co/40x40/505050/ffffff?text=V",
        sections: [
            {
                title: "Points",
                nominals: [
                    { amount: "475 Points", price: "Rp 55.000" },
                    { amount: "1000 Points", price: "Rp 112.000" },
                    { amount: "1475 Points", price: "Rp 162.000" },
                    { amount: "2050 Points", price: "Rp 214.000" },
                ]
            }
        ]
    },
    "honkai": {
        title: "Honkai Impact 3",
        subtitle: "miHoYo",
        logo: "https://placehold.co/40x40/505050/ffffff?text=H",
        sections: [
            {
                title: "Crystal",
                nominals: [
                    { amount: "65 Crystal", price: "Rp 15.000" },
                    { amount: "330 Crystal", price: "Rp 74.000" },
                    { amount: "710 Crystal", price: "Rp 160.000" },
                    { amount: "1430 Crystal", price: "Rp 330.000" },
                ]
            },
            {
                title: "B-chps",
                nominals: [
                    { amount: "30 B-chps", price: "Rp 8.000" },
                    { amount: "65 B-chps", price: "Rp 16.000" },
                    { amount: "330 B-chps", price: "Rp 74.000" },
                    { amount: "990 B-chps", price: "Rp 227.000" },
                ]
            }
        ]
    },
    "lol": {
        title: "League of Legends",
        subtitle: "Riot Games",
        logo: "https://placehold.co/40x40/505050/ffffff?text=LOL",
        sections: [
            {
                title: "RP",
                nominals: [
                    { amount: "575 RP", price: "Rp 58.000" },
                    { amount: "2800 RP", price: "Rp 267.000" },
                    { amount: "4500 RP", price: "Rp 423.000" },
                    { amount: "6500 RP", price: "Rp 595.000" },
                ]
            }
        ]
    }
};

const homePage = document.getElementById('home-page');
const paymentPage = document.getElementById('payment-page');
const gameCards = document.querySelectorAll('.game-card');
const backButton = document.getElementById('back-button');
const gameTitleEl = document.getElementById('game-title');
const gameSubtitleEl = document.getElementById('game-subtitle');
const gameLogoEl = document.getElementById('game-logo');
const nominalSectionsEl = document.getElementById('nominal-sections');
const paymentMethodsEl = document.getElementById('payment-methods');
const userIdInput = document.getElementById('user-id');
const buyButton = document.getElementById('buy-button');
const confirmationModal = document.getElementById('confirmation-modal');
const closeModalButton = document.getElementById('close-modal');
const modalOkButton = document.getElementById('modal-ok-button');
const modalTextEl = document.getElementById('modal-text');
const mobileMenuButton = document.getElementById('mobile-menu-button');
const mobileMenu = document.getElementById('mobile-menu');
const closeMenuButton = document.getElementById('close-menu-button');
const carouselContainer = document.getElementById('carousel-container');
const navLinks = document.querySelectorAll('nav a, #mobile-menu a');

let selectedNominal = null;
let selectedPaymentMethod = null;
let selectedGame = null;
let currentSlide = 0;

function sendToWhatsApp(message) {
    const phoneNumber = "6281234567890";
    const encodedMessage = encodeURIComponent(message);
    const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
    window.open(whatsappURL, '_blank');
}

function showModal(message, isConfirmation = false) {
    modalTextEl.textContent = message;
    confirmationModal.classList.remove('hidden');
    confirmationModal.style.display = 'flex';

    const newModalOkButton = modalOkButton.cloneNode(true);
    modalOkButton.parentNode.replaceChild(newModalOkButton, modalOkButton);
    newModalOkButton.addEventListener('click', () => {
        confirmationModal.style.display = 'none';
    });

    if (isConfirmation) {
        newModalOkButton.textContent = "OK";
        newModalOkButton.addEventListener('click', () => {
            const game = gamesData[selectedGame];
            const userId = userIdInput.value;
            const nominalTitle = selectedNominal.title ? `${selectedNominal.title} - ` : '';
            const message = `Halo Admin Diamond Zone, saya ingin top up game.\n\nDetail Pesanan:\n- Game: ${game.title}\n- ID Pengguna: ${userId}\n- Nominal: ${nominalTitle}${selectedNominal.amount} (${selectedNominal.price})\n- Pembayaran: ${selectedPaymentMethod.toUpperCase()}\n\nMohon diproses, terima kasih.`;
            sendToWhatsApp(message);
            confirmationModal.style.display = 'none';
        }, { once: true });
    }
}

function nextSlide() {
    currentSlide = (currentSlide + 1) % 3;
    carouselContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
}

function renderNominalSection(section, container) {
    const sectionContainer = document.createElement('div');
    sectionContainer.classList.add('card', 'rounded-2xl', 'p-6', 'mb-6', 'shadow-xl', 'bg-gray-900', 'bg-opacity-80', 'backdrop-blur-md');
    
    const sectionTitle = document.createElement('h3');
    sectionTitle.classList.add('text-lg', 'font-semibold', 'mb-2');
    sectionTitle.textContent = section.title;
    sectionContainer.appendChild(sectionTitle);

    const nominalsGrid = document.createElement('div');
    nominalsGrid.classList.add('grid', 'grid-cols-2', 'sm:grid-cols-3', 'gap-4');
    
    if (!section.nominals || section.nominals.length === 0) {
        nominalsGrid.innerHTML = '<p class="text-gray-400">Belum ada nominal tersedia.</p>';
    } else {
        section.nominals.forEach((nominal) => {
            const nominalCard = document.createElement('div');
            nominalCard.classList.add('payment-option', 'text-center', 'cursor-pointer', 'rounded-xl', 'p-4', 'bg-gray-800', 'hover:bg-gray-700', 'transition-colors');
            nominalCard.innerHTML = `
                <p class="font-bold text-lg">${nominal.amount}</p>
                <p class="text-sm text-gray-400">${nominal.price}</p>
            `;
            nominalCard.dataset.title = section.title;
            nominalCard.dataset.amount = nominal.amount;
            nominalCard.dataset.price = nominal.price;
            nominalCard.addEventListener('click', () => {
                document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('selected'));
                nominalCard.classList.add('selected');
                selectedNominal = { ...nominal, title: section.title };
            });
            nominalsGrid.appendChild(nominalCard);
        });
    }

    sectionContainer.appendChild(nominalsGrid);
    container.appendChild(sectionContainer);
}

document.addEventListener('DOMContentLoaded', () => {
    setInterval(nextSlide, 5000);

    function showPaymentPage(gameId) {
        const game = gamesData[gameId];
        if (!game) {
            showModal("Data game tidak ditemukan.");
            return;
        }

        selectedGame = gameId;
        gameTitleEl.textContent = game.title;
        gameSubtitleEl.textContent = game.subtitle;
        gameLogoEl.src = game.logo;

        nominalSectionsEl.innerHTML = '';
        game.sections.forEach(section => {
            renderNominalSection(section, nominalSectionsEl);
        });

        selectedNominal = null;
        selectedPaymentMethod = null;
        document.querySelectorAll('.payment-option.selected').forEach(el => el.classList.remove('selected'));
        userIdInput.value = '';

        homePage.classList.add('hidden');
        paymentPage.classList.remove('hidden');
        window.scrollTo(0, 0);
    }

    backButton.addEventListener('click', () => {
        homePage.classList.remove('hidden');
        paymentPage.classList.add('hidden');
    });

    gameCards.forEach(card => {
        card.addEventListener('click', () => {
            const gameId = card.dataset.game;
            showPaymentPage(gameId);
        });
    });

    paymentMethodsEl.addEventListener('click', (e) => {
        const target = e.target.closest('.payment-option');
        if (target) {
            document.querySelectorAll('#payment-methods .payment-option').forEach(el => el.classList.remove('selected'));
            target.classList.add('selected');
            selectedPaymentMethod = target.dataset.method;
        }
    });

    buyButton.addEventListener('click', () => {
        const userId = userIdInput.value;
        if (!userId) {
            showModal("MOHON MASUKKAN ID PENGGUNA ANDA.");
            return;
        }
        if (!selectedNominal) {
            showModal("MOHON PILIH NOMINAL TOP UP.");
            return;
        }
        if (!selectedPaymentMethod) {
            showModal("MOHON PILIH METODE PEMBAYARAN.");
            return;
        }
        
        showModal("PESANAN AKAN DIKIRIMKAN KE WHATSAPP ADMIN. TEKAN OK UNTUK MELANJUTKAN.", true);
    });

    closeModalButton.addEventListener('click', () => {
        confirmationModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
        if (e.target === confirmationModal) {
            confirmationModal.style.display = 'none';
        }
    });

    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.remove('hidden');
        mobileMenu.classList.add('flex');
    });

    closeMenuButton.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
    });

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            const targetId = link.getAttribute('href').substring(1);
            if (targetId) {
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    e.preventDefault();
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                    mobileMenu.classList.add('hidden');
                }
            }
        });
    });
});
